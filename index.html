
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <title>日本東北．冰雪之旅 2026</title>

    <!-- External libs: Tailwind for styling, FontAwesome for icons, Vue 3 (global build), Firebase compat (realtime DB) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-database-compat.js"></script>

    <script>
        /* Tailwind 額外顏色設定（可依需求擴充） */
        tailwind.config = {
            theme: { extend: { colors: { 'snow-white':'#F0FFFF','ice-blue':'#B3E5FC','light-snow-blue':'#E5F3F7','deep-sea-blue':'#01579B','accent-yellow':'#FFD54F','soft-gray':'#F5F5F5' } } }
        };
    </script>

    <style>
        /* 全站字型與基礎顏色 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { background:#E5F3F7; font-family:'Noto Sans TC',sans-serif; color:#334155; -webkit-tap-highlight-color:transparent; }

        /* App 容器：限制寬度、置中、視覺陰影 */
        .app-container{ max-width:480px;margin:0 auto;min-height:100vh;background:#fff;box-shadow:0 0 30px rgba(0,0,0,.05);position:relative;padding-bottom:90px; }

        /* Header 背景與圖片：圓角與溢出處理 */
        .header-bg{ background:#fff; position:relative; overflow:hidden; box-shadow:0 4px 15px rgba(0,0,0,.15); border-bottom-left-radius:35px;border-bottom-right-radius:35px; }
        .header-image-container{ height:250px; overflow:hidden; border-bottom-left-radius:35px;border-bottom-right-radius:35px; }
        .header-image-container img{ width:100%; height:100%; object-fit:cover; display:block; }

        /* 雪花圖層：用 SVG data-uri 模擬飄雪效果 */
        .snow-layer{ position:absolute; inset:0; background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><circle cx="50" cy="50" r="1" fill="%23fff" opacity="0.8"/><circle cx="20" cy="80" r="0.5" fill="%23fff" opacity="0.6"/><circle cx="70" cy="30" r="1.5" fill="%23fff" opacity="0.9"/></svg>'); background-size:100px 100px; opacity:.7; animation:snowfall 10s linear infinite; z-index:5; }
        @keyframes snowfall{ to{ background-position:100px 100px; } }

        /* 側邊分頁按鈕群組 */
        .side-tab-bar{ position:absolute; bottom:45px; right:16px; z-index:30; display:flex; gap:8px; }
        .tab-button{ width:40px;height:40px;border-radius:9999px;display:flex;align-items:center;justify-content:center;font-size:1.125rem;box-shadow:0 4px 10px rgba(0,0,0,.15); transition:all .2s; }
        .tab-button.active{ background:#01579B;color:#fff; transform:scale(1.05); box-shadow:0 6px 15px rgba(1,87,155,.4); }
        .tab-button:not(.active){ background:#fff;color:#B3E5FC; }

        .app-main{ padding-top:25px !important; position:relative; z-index:5; }

        /* 隱藏滾動條（僅視覺效果） */
        .hide-scrollbar::-webkit-scrollbar{ display:none; } .hide-scrollbar{ -ms-overflow-style:none; scrollbar-width:none; }

        .card-shadow{ box-shadow:0 4px 20px rgba(179,229,252,.3); transition:transform .2s,box-shadow .2s; }
        .animate-fade-in{ animation:fadeIn .4s ease-out; } @keyframes fadeIn{ from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none} }
        .fab-shadow{ box-shadow:0 4px 15px rgba(255,213,79,.5); }

        /* 備註收合效果 */
        .note-content { 
        max-height: 4.5rem; /* 預設高度，若內容短則自動適應 */
        overflow: hidden; 
        transition: max-height 0.3s ease-in-out;
        word-break: break-all; /* 修正：解決長網址溢出問題 */
        line-height: 1.5;
    } 
    .note-content.expanded { 
        max-height: 2000px; /* 展開後隨內容增高 */
    }
    /* 交通備註：移除寬度限制，改為自動換行並隨內容增高 */
.transport-note-box {
    word-break: break-all;
    overflow-wrap: break-word;
    white-space: normal; /* 覆蓋原本可能導致不換行的設定 */
    display: inline-block;
    max-width: 100%; /* 確保不超過父容器寬度 */
}

        /* 花費標籤圓形 */
        .expense-category-tag{ min-width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700;flex-shrink:0;box-shadow:0 2px 8px rgba(0,0,0,.1); }
        .expenses-banner{ background:linear-gradient(135deg,#01579B 0%,#0097A7 100%); }

        .date-selector-sticky{ background:#fff;border-bottom:1px solid #f0f0f0; z-index:20; top:0; }
    </style>
</head>
<body>
<div id="app" class="app-container">
    <!-- Header 區：背景圖 + 雪花層 + 側邊分頁按鈕 -->
    <div class="header-bg relative">
        <div class="header-image-container"><img src="0.jpg" alt="日本東北之旅"></div>
        <div class="snow-layer"></div>

        <!-- 側邊 tab 按鈕：切換 itinerary / info / shopping / expenses -->
        <div class="side-tab-bar">
            <button @click="currentTab='itinerary'" :class="{'active':currentTab==='itinerary'}" class="tab-button" title="行程"><i class="fa-solid fa-map-location-dot"></i></button>
            <button @click="currentTab='info'" :class="{'active':currentTab==='info'}" class="tab-button" title="資訊"><i class="fa-solid fa-circle-info"></i></button>
            <button @click="currentTab='shopping'" :class="{'active':currentTab==='shopping'}" class="tab-button" title="購物"><i class="fa-solid fa-basket-shopping"></i></button>
            <button @click="currentTab='expenses'" :class="{'active':currentTab==='expenses'}" class="tab-button" title="花費"><i class="fa-solid fa-coins"></i></button>
        </div>
    </div>

    <main class="p-4 app-main">
        <!-- ==========================
             ITINERARY（行程）分頁
             - 日期橫向滑動選擇
             - 顯示當日天氣
             - 列表呈現當天行程（可新增/編輯/排序/地圖導航）
           ========================== -->
        <section v-if="currentTab==='itinerary'" class="animate-fade-in">
            <!-- 日期選擇器（橫向） -->
            <div class="flex overflow-x-auto hide-scrollbar space-x-3 pb-4 mb-2 snap-x px-1 sticky date-selector-sticky pt-1 -mx-4 px-4">
                <div v-for="(d,i) in dates" :key="i" @click="selectedDateIndex=i"
                     class="snap-center flex-shrink-0 w-[58px] h-[68px] rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border-2 shadow-sm"
                     :class="selectedDateIndex===i ? 'bg-deep-sea-blue text-white border-blue-400 shadow-xl scale-110 z-10' : 'bg-white text-slate-500 border-slate-200 shadow-sm'">
                    <span class="text-sm font-bold uppercase tracking-wider">{{ d.weekday }}</span>
                    <span class="text-xs font-medium opacity-70">{{ d.date }}</span>
                </div>
            </div>

            <!-- 當日天氣卡片（使用 weatherData） -->
            <div v-if="weatherData[selectedDateIndex]" class="mb-4 bg-snow-white border border-ice-blue rounded-2xl p-4 flex justify-between items-center shadow-md">
                <div class="flex items-start text-deep-sea-blue space-x-4">
                    <i :class="getWeatherIcon(weatherData[selectedDateIndex].condition)" class="text-5xl text-blue-500"></i>
                    <div class="pt-1">
                        <div class="flex items-baseline">
                            <span class="text-3xl font-extrabold leading-none text-red-500">{{ weatherData[selectedDateIndex].tempMax || 0 }}°</span>
                            <span class="mx-1 text-slate-300 text-lg">/</span>
                            <span class="text-2xl font-bold leading-none text-blue-500">{{ weatherData[selectedDateIndex].tempMin || 0 }}°</span>
                            <span class="text-xs font-light text-slate-500 ml-1">C</span>
                        </div>
                        <span class="block text-xs text-slate-500 mt-1 font-medium">體感: {{ weatherData[selectedDateIndex].feel || 0 }}°C</span>
                    </div>
                </div>
                <div class="text-right text-xs text-slate-600 pl-3">
                    <span class="font-bold block text-slate-700">{{ getWeatherDescription(weatherData[selectedDateIndex].condition) }}</span>
                    <span class="mt-1 block text-deep-sea-blue font-bold">{{ weatherData[selectedDateIndex].locationName || '東北地區' }}</span>
                </div>
            </div>

            <!-- 行程清單（可排序、編輯、打開地圖） -->
            <div class="space-y-4">
                <div v-for="(item, idx) in currentItinerary" :key="item.id" class="relative group">
                    <div v-if="idx>0" class="pl-8 pb-2 flex items-center text-xs text-slate-400">
    <div class="h-6 w-0.5 bg-slate-200 absolute left-6 -top-3"></div>
    <i :class="getTransportIcon(item.transportType)" class="mr-2 text-slate-300 cursor-pointer hover:text-deep-sea-blue" @click="openMapDirections(currentItinerary[idx-1], item)"></i>
    
    <span class="font-bold">{{ item.travelTime || '移動中' }}</span>

    <span v-if="item.transitTime || item.transNote" class="ml-2 px-2 py-0.5 bg-slate-100 rounded text-[12px] text-slate-500 font-medium align-middle transport-note-box">
        <span v-if="item.transitTime" class="text-red-500 font-bold">
            <i class="fa-regular fa-clock text-[10px] mr-1"></i>{{ item.transitTime }}
        </span>
        
        <span v-if="item.transitTime && item.transNote" class="mx-1 opacity-30">|</span>
        
        <span v-if="item.transNote">{{ item.transNote }}</span>
    </span>
</div>

                    <article class="bg-white rounded-3xl p-5 card-shadow relative overflow-hidden flex items-start border border-ice-blue/50 min-h-[150px]" :class="item.category==='flight' ? 'bg-slate-50 border-blue-200':''">
                        <!-- 左側圖示（類別）與時間 -->
                        <div class="mr-4 flex flex-col items-center min-w-[52px]">
                            <div class="w-10 h-10 rounded-full text-white shadow-lg flex items-center justify-center text-sm mb-1" :class="getCategoryColor(item.category)"><i :class="getCategoryIcon(item.category)"></i></div>
                            <span v-if="item.startTime" class="text-[13px] font-black text-slate-500 mt-1 tracking-tighter">{{ item.startTime }}</span>
                        </div>

                        <!-- 主要內容：名稱、地址、備註 -->
                        <div class="flex-1 pb-1">
                            <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight pr-8">{{ item.name }}</h3>
                            <div class="text-sm text-slate-500 space-y-1.5 mt-2">
                                <p v-if="item.hours" class="flex items-center"><i class="fa-regular fa-clock w-4 text-center mr-2 text-ice-blue"></i> 營業: {{ item.hours }}</p>
                                <p v-if="item.price" class="flex items-center"><i class="fa-solid fa-ticket w-4 text-center mr-2 text-ice-blue"></i> {{ item.price }}</p>
                                <p v-if="item.address" class="flex items-start"><i class="fa-solid fa-location-dot w-4 text-center mr-2 mt-1 text-ice-blue"></i> {{ item.address }}</p>
                            </div>

                            <!-- 備註區：支援連結轉換與收合 -->
                            <div v-if="item.note && item.note.length" class="mt-3 text-xs bg-slate-50 p-2.5 rounded-lg border border-slate-100">
                                <p class="text-slate-600 font-bold mb-1 flex items-center"><i class="fa-solid fa-highlighter text-accent-yellow mr-2"></i> 備註</p>
                                <div class="note-content whitespace-pre-wrap" :class="{'expanded': item.isNoteExpanded}" v-html="renderNote(item.note)"></div>
                                <button v-if="item.note.length>50" @click="item.isNoteExpanded=!item.isNoteExpanded" class="text-deep-sea-blue font-bold mt-1 block">{{ item.isNoteExpanded ? '收合備註' : '查看更多...' }}</button>
                            </div>
                        </div>

                        <!-- 操作按鈕：上/下移、打開地圖、編輯 -->
                        <div class="absolute top-3 right-3 flex flex-col space-y-1">
                            <button v-if="idx>0" @click.stop="moveItineraryUp(item.id)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors"><i class="fa-solid fa-arrow-up"></i></button>
                            <button v-if="idx<currentItinerary.length-1" @click.stop="moveItineraryDown(item.id)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors"><i class="fa-solid fa-arrow-down"></i></button>
                            <button @click.stop="openMap(item.address||item.name)" class="w-7 h-7 bg-ice-blue text-deep-sea-blue rounded-full flex items-center justify-center text-xs hover:bg-deep-sea-blue hover:text-white transition-colors"><i class="fa-solid fa-location-arrow"></i></button>
                            <button @click.stop="editItem(item)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-200 transition-colors"><i class="fa-solid fa-pencil"></i></button>
                        </div>
                    </article>
                </div>

                <!-- 當天無行程提示 -->
                <div v-if="currentItinerary.length===0" class="text-center py-16 text-slate-300">
                    <i class="fa-solid fa-map-location-dot text-5xl mb-3 text-slate-200"></i>
                    <p class="text-sm">本日尚無行程<br>請點擊右下角新增</p>
                </div>
            </div>
        </section>

        <!-- ==========================
             INFO（資訊）分頁
             - 匯率換算小工具
             - 航班、住宿等固定資訊展示
           ========================== -->
        <section v-if="currentTab==='info'" class="space-y-5 animate-fade-in">
            <!-- 匯率換算區塊（currencyInput 乘以 EXCHANGE_RATE） -->
            <div class="bg-gradient-to-r from-deep-sea-blue to-cyan-700 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                <h3 class="font-bold text-lg mb-4 flex items-center"><i class="fa-solid fa-calculator mr-2"></i> 匯率換算</h3>
                <div class="flex items-center justify-between space-x-3">
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-200 block mb-1 uppercase tracking-wider">JPY (日幣)</label>
                        <input type="number" v-model.number="currencyInput" @input="calculateCurrency" class="w-full bg-white/20 border border-white/30 rounded-xl px-3 py-2.5 text-white placeholder-white/50 focus:outline-none text-lg font-bold" placeholder="¥"/>
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-cyan-300 mt-5"></i>
                    <div class="flex-1">
                        <label class="text-[10px] text-cyan-200 block mb-1 uppercase tracking-wider">TWD (台幣)</label>
                        <div class="w-full bg-white/10 rounded-xl px-3 py-2.5 text-white text-lg font-bold border border-transparent">$ {{ currencyResult }}</div>
                    </div>
                </div>
                <p class="text-[10px] text-cyan-300 mt-3 text-right">匯率基準: {{ EXCHANGE_RATE }}</p>
            </div>

            <!-- 固定航班資訊（顯示用） -->
            <div class="bg-white rounded-3xl p-5 card-shadow">
                <h3 class="font-bold text-slate-800 mb-3 border-b border-slate-100 pb-2"><i class="fa-solid fa-plane-departure text-blue-500 mr-2"></i> 航班資訊 (捷星航空)</h3>
                <div class="space-y-4">
                    <div class="bg-blue-50 rounded-xl p-3 border border-blue-100">
                        <div class="flex justify-between text-sm font-bold text-deep-sea-blue mb-1"><span>TPE 桃園</span><i class="fa-solid fa-plane text-xs"></i><span>NRT 成田</span></div>
                        <div class="flex justify-between text-xs text-slate-500"><span>02:30 (2/20)</span><span>A321neo</span><span>06:35</span></div>
                    </div>
                    <div class="bg-orange-50 rounded-xl p-3 border border-orange-100">
                        <div class="flex justify-between text-sm font-bold text-orange-800 mb-1"><span>NRT 成田</span><i class="fa-solid fa-plane text-xs"></i><span>TPE 桃園</span></div>
                        <div class="flex justify-between text-xs text-slate-500"><span>22:25 (2/27)</span><span>A321neo</span><span>01:30</span></div>
                    </div>
                </div>
            </div>

            <!-- 住宿資訊列表（hotels） -->
            <div class="bg-white rounded-3xl p-6 card-shadow">
                <h3 class="font-bold text-slate-800 mb-4 border-b border-slate-100 pb-3"><i class="fa-solid fa-hotel text-indigo-500 mr-2"></i> 住宿資訊</h3>
                <ul class="space-y-5">
                    <li v-for="hotel in hotels" :key="hotel.name" class="border-b last:border-0 pb-4 last:pb-0">
                        <div class="flex justify-between items-start group">
                            <div class="flex-1">
                                <span class="font-bold block text-slate-700 text-lg">{{ hotel.name }}</span>
                                <span class="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full inline-block mt-1">{{ hotel.date }}</span>
                            </div>
                            <button @click="openMap(hotel.name)" class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center group-hover:bg-indigo-500 group-hover:text-white transition-all"><i class="fa-solid fa-location-arrow text-xs"></i></button>
                        </div>
                        <div class="text-sm text-slate-500 mt-2"><p class="flex items-center"><i class="fa-regular fa-clock w-4 text-center mr-2 text-slate-300"></i> {{ hotel.time }}</p></div>
                    </li>
                </ul>
            </div>
        </section>

        <!-- ==========================
             SHOPPING（購物）分頁
             - 買家篩選按鈕
             - 顯示每位買家的購物清單（圖片支援）
           ========================== -->
        <section v-if="currentTab==='shopping'" class="animate-fade-in">
            <div class="flex overflow-x-auto hide-scrollbar space-x-2 pb-4 mb-2 sticky top-0 bg-white z-20 -mx-4 px-4 pt-1">
                <button v-for="p in buyers" :key="p" @click="selectedBuyer=p" :class="selectedBuyer===p ? 'bg-deep-sea-blue text-white shadow-md' : 'bg-slate-100 text-slate-500'" class="px-5 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all">{{ p }}</button>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div v-for="item in filteredShoppingList" :key="item.id" class="bg-white rounded-2xl p-3 card-shadow relative group">
                    <div class="aspect-square bg-slate-50 rounded-xl mb-3 overflow-hidden relative border border-slate-100">
                        <img v-if="item.image" :src="item.image" class="w-full h-full object-cover">
                        <div v-else class="w-full h-full flex items-center justify-center text-slate-300"><i class="fa-solid fa-bag-shopping text-3xl"></i></div>
                        <button @click="removeShoppingItem(item.id)" class="absolute top-2 right-2 bg-black/60 text-white rounded-full w-7 h-7 flex items-center justify-center text-xs"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                    <p class="font-bold text-sm text-slate-800 truncate px-1">{{ item.name }}</p>
                    <p class="text-[10px] text-slate-400 px-1 mt-0.5"><i class="fa-solid fa-user text-[8px] mr-1"></i>{{ item.buyer }}</p>
                </div>

                <div v-if="filteredShoppingList.length===0" class="col-span-2 text-center py-16 text-slate-300">
                    <i class="fa-solid fa-cart-plus text-5xl mb-3 text-slate-200"></i>
                    <p class="text-sm">目前 {{ selectedBuyer }} 的清單是空的<br>點擊右下角新增</p>
                </div>
            </div>
        </section>

        <!-- ==========================
             EXPENSES（花費）分頁
             - 個人應付款統計（personOwes）
             - 當日結算建議（settlements）
             - 每日統計/明細（filteredExpenses）
           ========================== -->
        <section v-if="currentTab==='expenses'" class="animate-fade-in">
            <div class="mb-6">
                <h4 class="text-xs font-bold text-slate-500 mb-3 pl-1"><i class="fa-solid fa-users mr-2 text-deep-sea-blue"></i>個人支出總計 (JPY)</h4>
                <div class="flex overflow-x-auto gap-3 hide-scrollbar py-2">
                    <div v-for="(amt,name) in personOwes" :key="name" class="expenses-banner min-w-[140px] text-white rounded-2xl p-4 shadow-lg relative overflow-hidden flex-shrink-0">
                        <div class="absolute -right-4 -top-4 bg-white/10 w-16 h-16 rounded-full blur-xl"></div>
                        <p class="text-[10px] text-cyan-100 opacity-80 mb-1">{{ name }}</p>
                        <h2 class="text-xl font-bold">¥ {{ formatNumber(Math.round(amt)) }}</h2>
                        <p class="text-[9px] mt-1 opacity-70">約 NT$ {{ formatNumber(Math.round(amt * EXCHANGE_RATE)) }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-2xl p-4 mb-4 card-shadow mx-1 border border-ice-blue/50">
                <h4 class="text-xs font-bold text-slate-500 mb-3 flex justify-between"><span><i class="fa-solid fa-hand-holding-dollar mr-2 text-deep-sea-blue"></i>{{ dates[expenseDateIndex].date }} 結算 (誰給誰)</span><span class="text-[10px] text-slate-400">JPY</span></h4>
                <div class="space-y-2">
                    <div v-for="(s,idx) in settlements" :key="idx" class="flex items-center justify-between bg-slate-50 p-3 rounded-xl border border-slate-100">
                        <div class="flex items-center space-x-2"><span class="font-bold text-slate-700 text-sm">{{ s.from }}</span><i class="fa-solid fa-arrow-right text-[10px] text-slate-300"></i><span class="font-bold text-deep-sea-blue text-sm">{{ s.to }}</span></div>
                        <div class="text-right"><p class="text-xs font-black text-red-500">¥ {{ formatNumber(s.amount) }}</p></div>
                    </div>
                    <div v-if="settlements.length===0" class="text-center py-2 text-slate-400 text-xs italic">本日帳目已平</div>
                </div>
            </div>

            <div class="mb-6 mx-1">
                <h4 class="text-xs font-bold text-slate-500 mb-3 pl-1"><i class="fa-solid fa-calendar-day mr-2 text-orange-400"></i>每日統計</h4>
                <div class="flex overflow-x-auto gap-2 hide-scrollbar">
                    <div v-for="(d,i) in dates" :key="d.date" @click="expenseDateIndex=i" class="min-w-[85px] p-2 rounded-xl border text-center flex-shrink-0 cursor-pointer" :class="expenseDateIndex===i ? 'bg-blue-50 border-deep-sea-blue shadow-sm' : 'bg-white border-slate-100'">
                        <p class="text-[10px]" :class="expenseDateIndex===i ? 'text-deep-sea-blue font-bold' : 'text-slate-400'">{{ d.date }}</p>
                        <p class="text-xs font-bold" :class="expenseDateIndex===i ? 'text-deep-sea-blue' : 'text-slate-700'">¥{{ formatNumber(dailyExpenses[d.date]||0) }}</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-t-3xl min-h-[400px] p-6 shadow-[0_-10px_40px_rgba(0,0,0,0.03)] -mx-4">
                <p class="text-[10px] text-slate-400 font-bold mb-4 uppercase tracking-widest">{{ dates[expenseDateIndex].date }} 消費明細 ({{ filteredExpenses.length }} 筆)</p>

                <div v-for="(exp,idx) in filteredExpenses" :key="idx" class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <div class="expense-category-tag mr-4 text-white" :class="getCategoryColor(exp.category)">{{ getCategoryLabel(exp.category) }}</div>
                        <div><p class="font-bold text-slate-700 text-sm mb-0.5">{{ exp.name }}</p><p class="text-[10px] text-slate-400 uppercase tracking-wide">{{ exp.payer }} 墊付 ({{ exp.splitMembers?.length }}人分)</p></div>
                    </div>
                    <div class="text-right flex items-center">
                        <p class="font-bold text-slate-700 text-sm">¥{{ formatNumber(exp.amount) }}</p>
                        <button @click="removeExpense(exp)" class="w-5 h-5 ml-3 text-red-300 hover:text-red-500 transition-colors"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </div>

                <div v-if="filteredExpenses.length===0" class="text-center py-10 text-slate-300"><p class="text-sm italic">本日無消費記錄</p></div>
            </div>
        </section>
    </main>

    <!-- 全域新增按鈕（FAB） -->
    <button v-if="currentTab!=='info'" @click="handleAddClick" class="fixed bottom-6 right-6 w-14 h-14 bg-accent-yellow rounded-full fab-shadow text-deep-sea-blue text-2xl flex items-center justify-center hover:scale-110 transition-transform z-40"><i class="fa-solid fa-plus"></i></button>

    <!-- ==========================
         Modal 區（三種：itinerary / shopping / expense）
         - 為了簡潔性，表單欄位與按鈕與原本功能一致
       ========================== -->
    <!-- ITINERARY Modal：新增 / 編輯行程 -->
   <div v-if="showItineraryModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center">
    <div class="bg-white w-full max-w-lg rounded-t-3xl sm:rounded-3xl p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
        
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-xl font-bold text-slate-800">{{ isEditMode ? '編輯行程' : '新增行程' }}</h3>
            <button @click="showItineraryModal = false" class="text-slate-400 hover:text-slate-600"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>

        <div class="space-y-5">
            <div class="grid grid-cols-2 gap-4">
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-400 ml-1">行程名稱</label>
                    <input v-model="newItinerary.name" placeholder="要去哪裡？" class="bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100"/>
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-400 ml-1">活動分類</label>
                    <select v-model="newItinerary.category" class="bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100">
                        <option value="sightseeing">景點</option>
                        <option value="food">美食</option>
                        <option value="shopping">購物</option>
                        <option value="accommodation">住宿</option>
                        <option value="flight">航班</option>
                        <option value="transport">交通</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-400 ml-1">開始時間</label>
                    <input v-model="newItinerary.startTime" type="time" class="bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100"/>
                </div>
                <div class="flex flex-col gap-1">
                    <label class="text-[10px] text-slate-400 ml-1">地址/地點</label>
                    <input v-model="newItinerary.address" placeholder="地點或地址" class="bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100"/>
                </div>
            </div>

            <div class="flex flex-col gap-1">
                <label class="text-[10px] text-slate-400 ml-1">行程詳細備註 (會自動換行)</label>
                <textarea v-model="newItinerary.note" placeholder="例如：預約號碼、門票資訊..." rows="3" 
                          class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100 min-h-[80px]"></textarea>
            </div>

            <div class="border-t border-slate-100 pt-4 mt-2">
                <div class="flex items-center text-slate-500 text-xs font-bold mb-3">
                    <i class="fa-solid fa-bus-simple mr-2"></i>交通與乘車資訊設定
                </div>
                
                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] text-slate-400 ml-1">交通工具</label>
                            <div class="flex gap-1">
                                <button v-for="t in ['walk','car','public','flight']" :key="t"
                                        @click="newItinerary.transportType = t"
                                        :class="newItinerary.transportType === t ? 'bg-deep-sea-blue text-white' : 'bg-slate-200 text-slate-500'"
                                        class="flex-1 py-2 rounded-lg text-xs transition-all">
                                    <i :class="getTransportIcon(t)"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] text-red-500 font-bold ml-1">班次時刻 (紅色顯示)</label>
                            <input v-model="newItinerary.transitTime" placeholder="例: 10:24" 
                                   class="bg-slate-50 rounded-xl p-3 text-sm text-red-500 font-bold outline-none focus:ring-2 focus:ring-red-100"/>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] text-slate-400 ml-1">總耗時 (如: 45m)</label>
                            <input v-model="newItinerary.travelTime" placeholder="輸入時長" 
                                   class="bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100"/>
                        </div>
                        <div class="flex flex-col gap-1">
                            <label class="text-[10px] text-slate-400 ml-1">轉乘備註 (如: 往仙台)</label>
                            <input v-model="newItinerary.transNote" placeholder="輸入備註" 
                                   class="bg-slate-50 rounded-xl p-3 text-sm outline-none focus:ring-2 focus:ring-blue-100"/>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-2 gap-3 mt-8">
            <button v-if="isEditMode" @click="deleteItineraryItem" class="bg-red-50 text-red-500 font-bold py-4 rounded-2xl hover:bg-red-100 transition-all">刪除項目</button>
            <button @click="saveItineraryItem" :class="isEditMode ? 'bg-deep-sea-blue text-white' : 'col-span-2 bg-deep-sea-blue text-white'" class="font-bold py-4 rounded-2xl shadow-lg shadow-blue-200 hover:brightness-110 transition-all">
                {{ isEditMode ? '儲存修改' : '加入行程' }}
            </button>
        </div>
    </div>
</div>

    <!-- SHOPPING Modal：新增購物項目（含圖片上傳） -->
    <div v-if="showShoppingModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6">
            <h3 class="font-bold text-center mb-4">新增購物清單</h3>
            <div class="mb-4 text-center">
                <div @click="$refs.fileInput.click()" class="w-24 h-24 bg-slate-50 rounded-2xl mx-auto flex flex-col items-center justify-center cursor-pointer border-2 border-dashed border-slate-200 overflow-hidden relative group">
                    <img v-if="newShoppingItem.image" :src="newShoppingItem.image" class="w-full h-full object-cover">
                    <div v-else class="text-slate-300"><i class="fa-solid fa-camera text-2xl mb-1"></i><p class="text-[10px]">上傳照片</p></div>
                    <div v-if="newShoppingItem.image" class="absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-opacity"><i class="fa-solid fa-rotate text-white text-sm"></i></div>
                </div>
                <input type="file" ref="fileInput" class="hidden" accept="image/*" @change="handleImageUpload"/>
            </div>
            <input v-model="newShoppingItem.name" placeholder="商品名稱" class="w-full bg-slate-50 p-3 rounded-xl mb-4"/>
            <div class="flex space-x-3">
                <button @click="showShoppingModal=false" class="flex-1 py-3 bg-slate-100 rounded-xl">取消</button>
                <button @click="addShoppingItem" class="flex-1 py-3 bg-deep-sea-blue text-white rounded-xl">新增</button>
            </div>
        </div>
    </div>

    <!-- EXPENSE Modal：新增花費（分攤設定） -->
    <div v-if="showExpenseModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm overflow-y-auto">
        <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl my-auto">
            <h3 class="font-bold text-center mb-4 text-slate-800">記一筆消費</h3>
            <div class="space-y-3">
                <select v-model="newExpense.category" class="w-full bg-slate-50 p-3 rounded-xl text-sm"><option value="food">美食</option><option value="sightseeing">景點</option><option value="transport">交通</option><option value="shopping">購物</option><option value="other">其他</option></select>
                <input v-model="newExpense.name" placeholder="項目名稱" class="w-full bg-slate-50 p-3 rounded-xl text-sm outline-none"/>
                <input v-model.number="newExpense.amount" type="number" placeholder="金額 (JPY)" class="w-full bg-slate-50 p-3 rounded-xl text-sm font-bold outline-none"/>
                <p class="text-[10px] text-slate-400 font-bold ml-1 mt-4">誰先付錢？</p>
                <div class="flex flex-wrap gap-2">
                    <button v-for="m in groupMembers" :key="'p'+m" @click="newExpense.payer=m" :class="newExpense.payer===m ? 'bg-deep-sea-blue text-white shadow-md' : 'bg-slate-50 text-slate-400'" class="px-3 py-1.5 rounded-xl text-xs">{{ m }}</button>
                </div>
                <p class="text-[10px] text-slate-400 font-bold ml-1 mt-4">誰要分攤？</p>
                <div class="flex flex-wrap gap-2">
                    <button v-for="m in groupMembers" :key="'s'+m" @click="toggleSplitMember(m)" :class="newExpense.splitMembers.includes(m) ? 'bg-cyan-600 text-white shadow-md' : 'bg-slate-50 text-slate-400'" class="px-3 py-1.5 rounded-xl text-xs">{{ m }}</button>
                </div>
            </div>
            <div class="flex space-x-3 mt-8">
                <button @click="showExpenseModal=false" class="flex-1 py-3 bg-slate-100 rounded-xl text-slate-500 font-bold">取消</button>
                <button @click="addExpense" class="flex-1 py-3 bg-accent-yellow text-deep-sea-blue rounded-xl font-bold">儲存項目</button>
            </div>
        </div>
    </div>
</div>

<!-- ==========================
     JavaScript（Vue App + Firebase）
     - 我在下方以區塊註解說明每一段用途
   ========================== -->
<script>
/* --------------------------
   Firebase (compat) 初始化
   - 使用 Realtime Database
   - tripRef 為同步的節點（trip_2025）
   -------------------------- */
/* --------------------------
   Firebase (compat) 初始化
   -------------------------- */
const firebaseConfig = {
    apiKey: "AIzaSyCcZkVvFk52AcfGu0cEENsD5jYJs1O2HZo",
    authDomain: "japantrip2026-da446.firebaseapp.com",
    databaseURL: "https://japantrip2026-da446-default-rtdb.firebaseio.com",
    projectId: "japantrip2026-da446",
    storageBucket: "japantrip2026-da446.firebasestorage.app",
    messagingSenderId: "441435573496",
    appId: "1:441435573496:web:7dd1eb9cc25f6ff1f53f0d"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const tripRef = db.ref('trip_2025');

const { createApp, ref, computed, watch, onMounted } = Vue;

createApp({
    setup(){
        const EXCHANGE_RATE = 0.215;
        const currentTab = ref('itinerary');
        const selectedDateIndex = ref(0);
        const expenseDateIndex = ref(0);

        const itineraryData = ref([[],[],[],[],[],[],[],[]]);
        const shoppingList = ref([]);
        const expenses = ref([]);
        const weatherData = ref({});

        const buyers = ref(['燕如','怡君','鈞晏','嘉緯','淑瑩','月雲']);
        const selectedBuyer = ref(buyers.value[0]);
        const groupMembers = ['燕如','怡君','鈞晏','嘉緯','淑瑩','月雲'];

        const dates = ref([
            {date:'2/20',weekday:'五'},{date:'2/21',weekday:'六'},{date:'2/22',weekday:'日'},{date:'2/23',weekday:'一'},
            {date:'2/24',weekday:'二'},{date:'2/25',weekday:'三'},{date:'2/26',weekday:'四'},{date:'2/27',weekday:'五'}
        ]);

        const hotels = ref([
            {name:'京阪仙臺飯店',location:'Sendai',date:'2/20 - 2/22',time:'In 15:00 / Out 11:00'},
            {name:'松島小松館好風亭',location:'Matsushima',date:'2/23',time:'In 15:00 / Out 10:00'},
            {name:'兩國休雷蓋特酒店',location:'Tokyo',date:'2/24 - 2/27',time:'In 15:00 / Out 11:00'}
        ]);

        const showItineraryModal = ref(false), showShoppingModal = ref(false), showExpenseModal = ref(false), isEditMode = ref(false);
        const currencyInput = ref(10000), currencyResult = ref(0);

        // 修正：確保 newItinerary 包含所有欄位
        const newItinerary = ref({ 
            id: null, name: '', category: 'sightseeing', startTime: '', 
            address: '', note: '', transportType: 'car', travelTime: '', 
            transNote: '', transitTime: '', isNoteExpanded: false 
        });
        const newShoppingItem = ref({ name:'', image:null });
        const newExpense = ref({ name:'', amount:null, category:'food', date:'', payer:groupMembers[0], splitMembers:[...groupMembers] });

        const CATEGORY_MAP = {
            sightseeing:{color:'bg-green-500',icon:'fa-solid fa-camera'},
            food:{color:'bg-red-500',icon:'fa-solid fa-utensils'},
            shopping:{color:'bg-indigo-500',icon:'fa-solid fa-bag-shopping'},
            accommodation:{color:'bg-purple-500',icon:'fa-solid fa-bed'},
            flight:{color:'bg-blue-500',icon:'fa-solid fa-plane'},
            transport:{color:'bg-orange-500',icon:'fa-solid fa-car'}
        };

        const currentItinerary = computed(()=> itineraryData.value[selectedDateIndex.value] || []);
        const filteredShoppingList = computed(()=> shoppingList.value.filter(i=>i.buyer===selectedBuyer.value));

        const dailyExpenses = computed(()=> {
            const d = {};
            expenses.value.forEach(e => { d[e.date] = (d[e.date]||0) + Number(e.amount||0); });
            return d;
        });

        const personOwes = computed(()=> {
            const t = {}; groupMembers.forEach(m=>t[m]=0);
            expenses.value.forEach(e=> {
                const per = Number(e.amount||0) / (e.splitMembers?.length || 1);
                e.splitMembers?.forEach(m => { if(t[m]!==undefined) t[m] += per; });
            });
            return t;
        });

        const filteredExpenses = computed(()=> expenses.value.filter(e => e.date === dates.value[expenseDateIndex.value].date));

        const settlements = computed(()=> {
            const bal = {}; groupMembers.forEach(m=>bal[m]=0);
            filteredExpenses.value.forEach(e=>{
                bal[e.payer] += Number(e.amount||0);
                const per = Number(e.amount||0) / (e.splitMembers?.length || 1);
                e.splitMembers?.forEach(m=> bal[m] -= per);
            });
            const payers = [], recv = [];
            Object.keys(bal).forEach(k=>{
                if(bal[k] > 1) recv.push({name:k,amount:bal[k]});
                else if(bal[k] < -1) payers.push({name:k,amount:Math.abs(bal[k])});
            });
            const out = [];
            payers.forEach(p=>{
                recv.forEach(r=>{
                    if(p.amount>0 && r.amount>0){
                        const s = Math.min(p.amount, r.amount);
                        out.push({from:p.name, to:r.name, amount: Math.round(s)});
                        p.amount -= s; r.amount -= s;
                    }
                });
            });
            return out;
        });

        const calculateCurrency = ()=> currencyResult.value = Math.round((Number(currencyInput.value)||0) * EXCHANGE_RATE);
        const formatNumber = n => (n||n===0) ? String(n).replace(/\B(?=(\d{3})+(?!\d))/g, ',') : '0';
        const getCategoryColor = c => CATEGORY_MAP[c]?.color || 'bg-gray-500';
        const getCategoryIcon = c => CATEGORY_MAP[c]?.icon || 'fa-solid fa-circle';
        const getCategoryLabel = c => ({sightseeing:'景點',food:'美食',shopping:'購物',accommodation:'住宿',flight:'航班',transport:'交通'}[c]||'其他');
        const getWeatherIcon = c => { if(!c) return 'fa-solid fa-cloud'; const m={snow:'fa-solid fa-snowflake',clear:'fa-solid fa-sun',clouds:'fa-solid fa-cloud',rain:'fa-solid fa-cloud-showers-heavy',mist:'fa-solid fa-smog'}; return m[c.toLowerCase()]||'fa-solid fa-cloud'; };
        const getWeatherDescription = c => { if(!c) return '讀取中'; const m={snow:'降雪',clear:'晴朗',clouds:'多雲',rain:'有雨',drizzle:'毛毛雨',thunderstorm:'雷雨',mist:'有霧',fog:'濃霧'}; return m[c.toLowerCase()]||'多雲'; };
        const getTransportIcon = t => ({walk:'fa-solid fa-shoe-prints',car:'fa-solid fa-car-side',public:'fa-solid fa-train-subway',flight:'fa-solid fa-plane'}[t]||'fa-solid fa-arrow-right');
        const renderNote = txt => txt ? txt.replace(/(https?:\/\/[^\s]+)/g, u => `<a href="${u}" target="_blank" class="text-blue-500 underline break-all">${u}</a>`) : '';

        const openMap = q => q && window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`, '_blank');
        const openMapDirections = (s,e) => {
            if(!s||!e) return;
            const origin = encodeURIComponent(s.address || s.name);
            const dest = encodeURIComponent(e.address || e.name);
            const mode = e.transportType === 'car' ? 'driving' : 'transit';
            window.open(`https://www.google.com/maps/dir/?api=1&origin=${origin}&destination=${dest}&travelmode=${mode}`, '_blank');
        };

        const syncToFirebase = ()=> tripRef.set({
            itineraryData: JSON.parse(JSON.stringify(itineraryData.value)),
            shoppingList: JSON.parse(JSON.stringify(shoppingList.value)),
            expenses: JSON.parse(JSON.stringify(expenses.value))
        });

        // 修正：將所有函式移出 handleAddClick
        const handleAddClick = () => {
            if (currentTab.value === 'itinerary') {
                isEditMode.value = false;
                newItinerary.value = { 
                    id: Date.now(), name: '', category: 'sightseeing', startTime: '', 
                    address: '', note: '', transportType: 'car', travelTime: '', 
                    transNote: '', transitTime: '', isNoteExpanded: false 
                };
                showItineraryModal.value = true;
            } else if (currentTab.value === 'shopping') {
                showShoppingModal.value = true;
            } else if (currentTab.value === 'expenses') {
                showExpenseModal.value = true;
            }
        };

        const saveItineraryItem = ()=>{
            const list = itineraryData.value[selectedDateIndex.value];
            if(isEditMode.value){
                const i = list.findIndex(x=>x.id===newItinerary.value.id);
                if(i!==-1) list[i] = { ...newItinerary.value };
            } else {
                list.push({ ...newItinerary.value, id: Date.now() });
            }
            showItineraryModal.value = false; syncToFirebase();
        };

        const deleteItineraryItem = ()=> {
            if(confirm('確定要刪除此行程嗎？')){
                const list = itineraryData.value[selectedDateIndex.value];
                const i = list.findIndex(x=>x.id===newItinerary.value.id);
                if(i!==-1){ list.splice(i,1); showItineraryModal.value=false; syncToFirebase(); }
            }
        };

        const editItem = itm => { isEditMode.value=true; newItinerary.value = JSON.parse(JSON.stringify(itm)); showItineraryModal.value=true; };
        const moveItineraryUp = id => { const l = itineraryData.value[selectedDateIndex.value]; const i=l.findIndex(x=>x.id===id); if(i>0){ [l[i-1],l[i]]=[l[i],l[i-1]]; syncToFirebase(); } };
        const moveItineraryDown = id => { const l = itineraryData.value[selectedDateIndex.value]; const i=l.findIndex(x=>x.id===id); if(i<l.length-1){ [l[i+1],l[i]]=[l[i],l[i+1]]; syncToFirebase(); } };

        const handleImageUpload = e => {
            const f = e.target.files?.[0];
            if(!f) return;
            if(f.size > 1024*1024){ alert('圖片太大囉，請選擇小於 1MB 的照片'); return; }
            const r = new FileReader();
            r.onload = ev => newShoppingItem.value.image = ev.target.result;
            r.readAsDataURL(f);
        };

        const addShoppingItem = ()=>{
            if(!newShoppingItem.value.name) return;
            shoppingList.value.push({ id: Date.now(), name: newShoppingItem.value.name, image: newShoppingItem.value.image, buyer: selectedBuyer.value });
            showShoppingModal.value = false; newShoppingItem.value = { name:'', image:null }; syncToFirebase();
        };

        const removeShoppingItem = id=>{
            const i = shoppingList.value.findIndex(x=>x.id===id);
            if(i!==-1){ shoppingList.value.splice(i,1); syncToFirebase(); }
        };

        const toggleSplitMember = m => {
            const idx = newExpense.value.splitMembers.indexOf(m);
            if(idx > -1){ if(newExpense.value.splitMembers.length > 1) newExpense.value.splitMembers.splice(idx,1); }
            else newExpense.value.splitMembers.push(m);
        };

        const addExpense = ()=>{
            if(!newExpense.value.amount || !newExpense.value.name) return;
            newExpense.value.date = dates.value[expenseDateIndex.value].date;
            expenses.value.push({...newExpense.value});
            showExpenseModal.value = false;
            newExpense.value = { name:'', amount:null, category:'food', date:'', payer:groupMembers[0], splitMembers:[...groupMembers] };
            syncToFirebase();
        };

        const removeExpense = item => {
            if(confirm('確定要刪除這筆花費嗎？')){
                const i = expenses.value.findIndex(e=>e===item);
                if(i!==-1){ expenses.value.splice(i,1); syncToFirebase(); }
            }
        };

        const fetchWeather = async ()=>{
            const idx = selectedDateIndex.value;
            let city = idx <= 2 ? 'Sendai' : (idx === 3 ? 'Matsushima' : 'Tokyo');
            try{
                const apiKey = '5e1e88597b11b5dbf9f550ee7b26e17a';
                const res = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city},JP&units=metric&appid=${apiKey}&lang=zh_tw&_=${Date.now()}`);
                const data = await res.json();
                if(data?.weather && data?.main){
                    const cur = Math.round(data.main.temp);
                    weatherData.value[idx] = {
                        condition: data.weather[0].main.toLowerCase(),
                        tempMax: data.main.temp_max === data.main.temp_min ? cur + 3 : Math.round(data.main.temp_max),
                        tempMin: data.main.temp_max === data.main.temp_min ? cur - 2 : Math.round(data.main.temp_min),
                        feel: Math.round(data.main.feels_like),
                        locationName: city === 'Sendai' ? '仙台' : city === 'Matsushima' ? '松島' : '兩國 (東京)'
                    };
                }
            } catch(e){ console.error('天氣更新失敗', e); }
        };
        watch(selectedDateIndex, ()=>fetchWeather(), { immediate:true });

        onMounted(()=>{
            calculateCurrency();
            tripRef.on('value', snap => {
                const d = snap.val();
                if(!d) return;
                if(d.itineraryData) itineraryData.value = d.itineraryData;
                if(d.shoppingList) shoppingList.value = d.shoppingList;
                if(d.expenses) expenses.value = d.expenses;
            });
        });

        return {
            EXCHANGE_RATE, currentTab, dates, selectedDateIndex, itineraryData, currentItinerary, hotels, shoppingList, expenses,
            weatherData, currencyInput, currencyResult, calculateCurrency, formatNumber, getCategoryColor, getCategoryIcon, getCategoryLabel,
            getWeatherIcon, getWeatherDescription, getTransportIcon, renderNote, openMap, openMapDirections, handleAddClick,
            showItineraryModal, showShoppingModal, showExpenseModal, isEditMode, newItinerary, newShoppingItem, newExpense,
            saveItineraryItem, deleteItineraryItem, editItem, moveItineraryUp, moveItineraryDown, addShoppingItem, removeShoppingItem,
            addExpense, removeExpense, buyers, selectedBuyer, filteredShoppingList, expenseDateIndex, handleImageUpload, groupMembers,
            settlements, toggleSplitMember, dailyExpenses, personOwes, filteredExpenses
        };
    }
}).mount('#app');
</script>
</body>
</html>
